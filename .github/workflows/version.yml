name: Add Version Number
on: workflow_call

env:
  TZ: "Asia/Tokyo"
  FILE_NAME: "./Firmware/RP2040_Universal_SFP_Transceiver/src/version.h"
  FILE_HEADER: "#ifndef VERSION_H\n#define VERSION_H\n\n// !!! DO NOT EDIT THIS FILE !!!\n// This file is automatically generated by GitHub Actions\n"
  FILE_FOOTER: "\n#endif"

jobs:
  generate:
    runs-on: ubuntu-latest
    steps:

    - name: Checkout
      uses: actions/checkout@v4

    - name: Create File
      run: |
        cat <<EOF > "$FILE_NAME"
        $FILE_HEADER
        #define VER_BRANCH_STR "$GITHUB_REF_NAME"
        #define VER_SHA_STR "$GITHUB_SHA"
        #define VER_RUN_ID $GITHUB_RUN_ID
        #define VER_RUN_ID_STR "$GITHUB_RUN_ID"
        #define VER_RUN_NUM $GITHUB_RUN_NUMBER
        #define VER_RUN_NUM_STR "$GITHUB_RUN_NUMBER"
        #define VER_YEAR $(date +'%y')
        #define VER_YEAR_STR "$(date +'%y')"
        #define VER_MON $(date +'%m')
        #define VER_MON_STR "$(date +'%m')"
        #define VER_DATE $(date +'%d')
        #define VER_DATE_STR "$(date +'%d')"
        #define VER_HOUR $(date +'%H')
        #define VER_HOUR_STR "$(date +'%H')"
        #define VER_MIN $(date +'%M')
        #define VER_MIN_STR "$(date +'%M')"
        #define VER_SEC $(date +'%S')
        #define VER_SEC_STR "$(date +'%S')"
        $FILE_FOOTER
        EOF

    - name: Commit Push
      run: |
        git config user.name "GitHub Actions"
        git config user.email "github-actions@github.com"
        git add "$FILE_NAME"
        git commit -m "Add Version Number"
        git push

